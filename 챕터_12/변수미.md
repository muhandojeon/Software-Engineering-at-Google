테스트의 가장 중요한 목적은

- 버그예방
- 엔지니어의 생산성 개선

범위가 넓은 테스트와 비교해, 단위 테스트는 생산성을 끌어올리는 휼륭한 수단이 될 수 있는 특정을 지니고 있습니다.

- 피드백을 즉각 얻을 수 있습니다.
- 코드와 동시에 작성할 수 있을만큼 작성하기 쉽습니다.
- 실패시 원한을 파악하기 쉽습니다.
- 등등..

### '깨지기 쉬운 테스트'를 예방해야한다.

깨지기 쉬운 테스트 : 실제로는 버그가 없음에도, 관련없는 변경으로 인해 실패하는 테스트

##### 1. 변하지 않는 테스트로 만들자

'테스트를 처음 작성한 후 얼마나 자주 변경할거라 예상하는가?'
-> 이상적인 테스트라면 변경되지 않아야하지만 현실에서는 쉽지않다. 변경 유형별로 어떻게 대응할지 따져봐야한다.

기본적인 변경 유형 네가지

- 순수 리팩터링
  - 테스트는 변경되지 않아야한다.
- 새로운 기능 추가
  - 새 기능을 검증할 테스트를 새로
  - 기존 테스트들은 변경되지 않아야한다.
- 버그 수정
  - 버그가 존재한다는건 기존 테스트에 빠진게 있다는 것
  - 버그 수정과 동시에 누락된 테스트를 추가해야한다.
- 행위 변경
  - 기존 테스트 또한 변경되어야합니다. (의도적인 변경)

##### 2. 공개 API를 이용해 테스트하자

'테스트로 시스템을 다른 사용자 코드와 똑같은 방식으로 호출하기'
-> 테스트가 실패하면 사용자도 같은 문제를 겪게됩니다.

> 책에서 `공개 API`라길래 `Open API` 등을 말하는건가? 했는데, 숨겨져있는 내부 API, 메서드 등을 사용해서 테스트하지 말라는 거였네요

##### 3. 상호작용이 아니라 상태를 테스트하자

시스템이 기대한 대로 동작하는 검증하는 방법은 `상태 테스트`, `상호작용 테스트`두가지가 있는데

상호작용 테스트는 상태 테스트보다 깨지기 쉽습니다.
<- 상호작용 테스트는 결과에 도달하기 까지 시스템이 **어떻게 작동하냐**를 확인하려 하기 때문 (우리가 원하는 것은 결과가 **무엇이냐**)

### 명확한 테스트를 작성하기

테스트가 실패하는 이유로는

- 시스템에 문제가 있거나 불완전, 테스트는 이 문제를 잡아낼 목적으로 설계된 것
- 테스트 자체에 결함이 있는 경우 <- 깨지기 쉬운 테스트라는 뜻

테스트가 실패하면 어떤 이유인지 먼저 확인해야하고, 이 일을 얼마나 빠르게 마치느냐는 테스트의 **명확성**에 달려있습니다.

명확한 테스트 : 존재 이유와 실패 원인을 엔지니어가 곧바로 알아차릴 수 있는 테스트

##### 1. 완전하고 간결하게 만들자

테스트 본문에는 테스트를 이해하는데 필요한 정보를 모두 담고,그와 동시에 눈을 어지럽히거나 관련없는 정보는 담지 않아야한다.

##### 2. 메서드가 아니라 행위를 테스트하자

행위 : 특정 상태에서 특정한 일련의 입력을 받았을 때 시스템이 보장하는 '반응'

> 책에서는 전체적으로 단순히 메서드 하나하나기 잘 만들어졌는지를 테스트하는 것이 아니라 해당 메서드, 동작이 이루어져서 나타내는 `상태`, `반응`이 원하는 결과값과 같은지 확인해라 라는 말을 하는것 같네요

장점

1. 자연어에 더 가깝게 읽혀 분석 없이 자연스레 이해할 수 있다
2. 테스트 각각이 좁은 범위를 검사하기 때문에 원인/결과가 분명하게 들어난다.
3. 각 테스트가 짧고 서술적이라 이미 검사한 기능이 무엇인지 파악이 쉽다.

### 테스트와 코드 공유

DRY를 고집하는 대신 테스트 코드는 DAMP가 되도록 노력해야 합니다

DRY : 반복하지 말라
DAMP : 서술적이고 의미있는 문구

#### 공유값

필요한 값들을 테스트마다 일일이 준비하려면 장황하고 귀찮기 때문에 상수를 정의해서 공유하고 싶습니다..
하지만 이후에 문제가 될 수 있습니다.

따라서 `도우미 메서드`를 이용해 데이터를 구성하는 것이 좋습니다.

```js
function newContact(
  firstName = "Grace",
  lastName = "Hopper",
  phoneNumber = "555-123-4567"
) {
  return {
    firstName: firstName,
    lastName: lastName,
    phoneNumber: phoneNumber,
  };
}

const contact1 = newContact(); // 기본값 사용
```

> 현재 대량의 데이터를 조작하는 유틸 메소드 등을 테스트하려고하는데, 이렇게 도우미 메서드를 사용하는게 좋을 것 같네요

## 핵심

• 변하지 않는 테스트를 만들기 위해 노력하세요.
• 공개 API를 통해 테스트하세요.
• 상호작용이 아닌. 상태를 테스트하세요.
• 테스트를 완전하고 명확하게 만드세요.
• 메서드가 아닌, 행위를 테스트하세요.
• 행위가 부각되게끔테스트를 구성하세요.
• 테스트 이름은 검사하는 행위가 잘 드러나게 지으세요.
• 테스트에 로직을 넣지 마세요.
• 실패 메시지를 명확하게 작성하세요.
• 테스트들이 코드를 공유할 때는 DRY보다 DAMP를 우선하세요.
