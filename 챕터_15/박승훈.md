## 들어가며

- 폐기(deprecated): migration을 순차적으로 진행하여 낡은 시스템을 완전히 걷어내는 과정
- 시스템 관리에 세월을 고민해야 하는 SW 엔지니어링 원칙에 속하는 주제
- 제대로 폐기시키지 못하면 시스템을 방치할 때보다 더 큰 비용을 치를 수 있다.

## 폐기시키는 이유

- 기본 전제: "코드는 자산이 아니라 부채다"
- 시스템이 오래됐다고 해서 무조건 폐기시켜야 하는 것은 아니다.(e.g. LaTeX)
- 폐기는 **시대에 뒤처졌음을 보여줄 수 있고, 비슷한 기능의 대체재가 존재하는 시스템에 적합**
- 폐기 대상을 신중하게 선택한 다음, 집중해서 빠르게 완료하는 게 중요

## 폐기는 왜 그리 어려운가?

- `하이럼의 법칙` : 시스템은 사용자 수가 늘수록 설계자가 예상하지 못한 방식으로 이용될 가능성이 높다. '되니까 쓰는 것'이지 시스템이 '보장하는 동작'이 아니다. '되니까 쓰는' 기능과 함께 이를 활용하던 사용자까지 한꺼번에 떼어내버릴 것
- `비가역성` : 시스템 하나를 제거한다는 것은 돌이킬 수 없는 변경이 될 수 있다.
- `기능의 유실` : 새로운 시스템이 더 좋을지라도, 분명히 '다를' 것이기 때문에 두 시스템의 기능이 일대일로 일치하는 일은 드물다.
- `옛 시스템을 향한 애착` : 의외의 저항으로 나타날 수 있다. 궁극적으로는 피해가 되돌아온다. **시스템이 낡으면 조직에 비용을 발생시키므로 제거해야 한다.**
- `정치` : 비용을 확보해 폐기를 진행하려면 정치 관문을 통과해야 한다. 오래된 시스템을 제거하는 데에는 눈에 보이는 비용이 든다. 아무것도 하지 않고 시스템을 방치해서 새어나가는 비용은 눈에 잘 띄지 않는다.

> 저는 지금 회사에서 대표 웹사이트를 리뉴얼하는 프로젝트를 진행하고 있는데, 관리자 페이지에서 유관 부서들의 입장들이 많이 생각이 나는 대목이었습니다. 사용자들이 어떤 식으로 기능을 활용하고 있고, 기존의 어떤 기능들을 포기할 수 없는지 목소리를 듣는 일들이 많았는데 특히 구세대 에디터를 신규 에디터로 바꾸는 과정에서 1:1로 최대한 기존 기능들을 호환하게 하기 위해 힘썼던 시간이 생각나네요.

### 설계 단계에서의 폐기

- 엔지니어들이 '이 시설은 언젠가는 해체시켜야 한다'라는 사실을 인지하고 있느냐가 설계에 큰 영향을 준다.
- 불행히도 많은 상급자와 소프트웨어 엔지니어가 기존 시스템을 유지보수하는 일보다는 새로운 시스템을 구축하고 론칭하는 일을 원한다. 기업 문화 역시 새로운 제품을 빠르게 만들어 출시하도록 독려한다. 처음부터 폐기를 고려해 설계해야 할 동기를 떨어뜨린다.
- 구글에서 엔지니어링팀에 권장하는 고려사항
  - 내 제품의 고객이 잠재적인 대체품으로 이주하기가 얼마나 쉬울까?
  - 내 시스템을 한 부분씩 점진적으로 교체하려면 어떻게 해야 할까?
- 프로젝트의 장기 지원 여부는 조직에서 프로젝트를 처음 승인할 때 결정된다. 소프트웨어가 한 번 론칭되고 나면 우리가 할 수 있는 일은 **계속 지원하거나, 조심스럽게 폐기시키거나, 어쩔 수 없는 어떤 외부 요인이 발생했을 때 운영을 중단하거나.**
- 결론은 **회사에서 기대 수명동안 제대로 지원하지 못할 것 같은 프로젝트는 시작하지 마라.** 폐기시키기로 결정해도 여전히 비용이 든다.

## 폐기 유형

폐기는 크게 '권고'와 '강제'로 구분한다.

### 권고 폐기(advisory deprecation)

- **대체로 강제성이 없는 폐기 유형**
- 기한이 없고 조직에서도 우선순위가 높지 않은 경우
- 또는 폐기 작업에 자원을 투입할 의지가 없는 경우
- 사용자가 새로운 시스템으로 이주하기를 바라지만 서둘러 이주를 돕거나 옛 시스템을 바로 걷어낼 계획은 없을 때
- 새로운 시스템이 사용자에게 주는 혜택이 매우 클 때 효과가 좋다. 이는 '정말 좋다' 정도가 아닌 '혁신적이다' 수준이어야 한다.
- 대다수가 움직여주리라 기대하진 말 것.

### 강제 폐기(compulsory deprecation)

- **낡은 시스템의 지원 종료일을 못 박는 형태** 종료일 이후까지 이주를 끝내지 못한 시스템은 제대로 작동되지 않을 것
- 큰 조직에서 강제 폐기를 효율적으로 수행하려면 기존 시스템을 완전히 제거하는 역할을 전담할 팀을 하나 따로 꾸리는 것이 좋다.
- 강제 폐기가 잘 이루어지려면 일정대로 집행할 수 있는 권한이 주어져야 한다. 이주 과정에서 충분히 경고했다면 기한을 넘겨서까지 기존 시스템을 이용하는 시스템에 문제가 생겨도 책임을 묻지 않도록 해야 한다.
- 인력 지원 없이 강제 폐기를 밀어붙이면 고객 팀의 반발은 사서 폐기 작업이 지연될 것이다. "지원 없이 주어지는 의무"로 받아들이면 문제가 된다.
- **강제 폐기를 시도하려면 반드시 전문 팀을 꾸려 적극적으로 지원하게 하라.**
- 완전 폐기 이전에 서비스를 의도적으로 일시 중지시켜서 의존성을 확인하게 하라.

## 폐기 경고

- 시스템이 폐기 대상임을 프로그래밍적으로 알려주면 좋다. 시스템 이용자가 폐기 사실을 인지해야 이주를 준비할 수 있다.
- "희망은 전략이 아니다." 폐기 경고는 새로운 사용자 유입은 대체로 잘 막아주지만, 기존 사용자를 이주시키는 데는 효과가 거의 없다.
- 폐기 경고 메시지에는 반드시 담겨야 할 특성이 있다.
  - 실행 가능성(actionability): 실질적인 조치를 취할 수 있는가.
  - 적시성(relevance): 적절한 때에 경고가 뜨는가. (사용자가 실제로 관련 동작을 수행할 때 뜨면 적절하다.)
  - 하고 싶을 때마다 경고를 하면, 우호적인 엔지니어까지 질리게 할 수 있다.

## 폐기 프로세스 관리

폐기 프로젝트는 시스템 구축이 아니라 해체가 목적이므로 결이 다를 것 같지만, 관리하고 실행해야 한다는 점에서 다른 프로젝트와 비슷하다. 유사점은 빼고, 차이점만 짚어보자.

### 프로젝트 소유자

- 폐기 프로세스를 관리하고 실행하는 일에 프로젝트 소유자를 명시적으로 할당하라.
- 폐기 업무를 시스템 이용자들에게 절대 떠넘기지 말라. 권고 폐기와 같아져서 말끔하게 끝나지 않을 것이다.
- 방치된 프로젝트는 폐기 전문가를 배정하여 하루 빨리 제거해야 한다. 사이드 프로젝트가 아닌 주된 목표로 진행한다.

### 마일스톤

- 폐기 완료 시점이 유일한 마일스톤으로 두지 말라.
- 새로운 제품을 구축할 때 주요 컴포넌트를 하나씩 완성하는 걸 마일스톤으로 삼듯, 폐기시킬 때도 핵심 컴포넌트들을 하나씩 제거하는 걸 점진적 마일스톤으로 삼으면 효과가 좋다.

### 폐기 도구

#### 발견

- 낡은 시스템을 '누가', '어떻게' 이용하고 있는지 알아야 한다.
- 예상하지 못한 방식으로 이용하고 있지는 않는지 알아내야 한다.
- 폐기시킬 심볼의 참조가 모두 제거되었는지를 확인해야 한다.

#### 마이그레이션

- 폐기의 상당 부분을 코드 생성 및 리뷰 도구를 활용해 처리한다.
- 새로운 라이브러리나 런타임 서비스를 이용하도록 코드베이스를 업데이트할 때는 도구가 유용하다.

#### 퇴행 방지

- 퇴행: 새로 작성하는 코드에서 폐기 중인 대상을 이용하는 것
- 폐기 지원 인프라가 챙겨야 할 중요한 역할
