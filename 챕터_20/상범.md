# 챕터 20 정적 분석

- 정적분석 : ‘프로그램을 실행하지 않은 채로’ 소스 코드를 분석하여 버그나 안티패턴 등의 잠재적인 문제를 찾아내는 것
- 동적분석 : 프로그램을 실행하여 분석하는 것

구글은 정적 분석을 이용해 모범 사례를 코드에 배포하고, 최신 API를 이용하게 하고, 기술 부채를 막거나 줄여줌 

예를 들어 명명 규칙을 따르는지 검증하고, 폐기 대상 API를 사용하려 하면 알려주고, 같은 의미의 더 간단한 표현식을 제안하여 코드를 더 읽기 쉽게 해줌 (+ 개발자 교육에도 사용)

## 효과적인 정적 분석 특징

### 확장성

구글의 정적 분석 도구는 엄청난 코드베이스 안에서 돌아가야 됨. 이를 위해 코드 분할하고 점진적으로 분석하는 길을 택함

거대한 프로젝트들 모두를 분석하는 대신 보류 중인 코드 변경에 영향받는 파일들을 분석하는 데 집중하고, 편집된 파일이나 라인과 연관된 분석 결과만 보여줬다고 하네요 

### 유용성

분석 유용성 측면에서는 사용자들의 비용-편익 트레이드오프 를 고려해야 함

정적 분석 경고(혹은 죽은 코드 경고를 없애기)를 해결하려다가 새로운 버그가 발생할 수 있고 자주 수정되지 않는 코드일 경우, 잘 동작 중이라면 수정할 필요 없을 수 있음

개발자의 시간은 소중하다! 중요한 문제를 선별하거나 강조된 문제를 수정하는 데 쓴 시간을 그 분석이 제공한 편익과 저울질 해봐야 한다

## 정적 분석을 적용하며 구글이 깨우친 핵심 교훈 세가지

### 개발자 행복에 집중하자

정적 분석 도구를 사용하고 싶은 마음을 이끌어내는 데는 오히려 거짓 양성 비율을 낮추는게 더 효과적임

거짓 양성 비율의 핵심은 인식에 있고, 거짓 양성이라고 인식하는 비율을 유효 거짓 양성이라고 부름

그 유효 거짓 양성은 검출한 문제에 대해 긍정적인 조치를 취하지 않은 경우고, 분석 도구가 잘못된 보고를 하더라도 개발자가 가독성과 유지보수성에 용이하게 한다는 취지에서 기꺼이 코드를 수정하면 유효 거짓 양성이 아니라고 함


### 정적 분석을 개발자 워크플로에 반드시 끼워 넣자

개발자들은 리뷰 요청 보내고는 보통 리뷰어들 피드백 기다리면서 다른 일에 착수하는데, 이때가 정적 분석을 수행하기 딱 좋은 타이밍임

흔한 문제를 자동으로 부각해주니 리뷰어의 시간도 절약 됨

### 사용자가 기여할 수 있도록 하자

정적 분석은 전문가의 지식을 수용하여 널리 퍼뜨릴 수 있는 훌륭한 통로여서 전문가들은 새로운 분석 도구를 만들거나 기존 도구에 검사 로직을 추가하는 식으로 기여할 수 있다

## Tricorder: 구글의 정적 분석 플랫폼

개발자 워크플로에 통합하기 위해 노력했고, 지금은 Critique에 통합되어 사용 중임

팀별 특화된 프리서브밋을 만들어서 활용하는 팀도 있음, 그러다보니 특정 코드들 때문에 대규모 변경을 진행하기가 어려워 질 수 있기도 함. 그럴때는 특정 코드들을 건너뛰게 할 수 있다고는 하는데 좋은 방법인지는 모르겠음



