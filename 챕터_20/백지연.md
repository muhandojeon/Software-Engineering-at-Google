# CHAPTER 20 정적 분석

정적 분석은 **프로그램을 실행하지 않은 채로 소스 코드를 분석**하여 버그나 안티패턴 등의 잠재적인 문제를 찾아내는 것을 말한다.  
오버플로를 일으키는 상수 표현식, 실행되지 않는 테스트, 실행하면 비정상 종료를 일으키는 잘못된 포맷의 문자열 등을 찾아준다.

## 20.1 효과적인 정적 분석의 특징

### 1. 확장성

소프트웨어가 점점 커지면서 분석에 걸리는 시간도 같이 늘어남 -> 개발 프로세스 전체가 느려짐  
그래서 분석 도구들은 코드량이 많아도 결과를 빨리 내놓을 수 있도록 확장성에 집중하기 시작함  

구글의 정적 분석 도구는 코드를 분할하고 점진적으로 분석하는 길을 택함  
전체를 분석하는 대신 보류 중인 코드 변경에 영향받는 파일들을 분석하는 데 집중하고, 편집된 파일/라인에 연관된 분석 결과만 보여줌  

### 2. 유용성

구글은 새로 작성했거나 수정된 코드에서의 경고에 집중함  
분석 보고서에 있는 문제를 수정하는 데 쓴 시간을 그 분석이 제공한 편익과 비교해야 함  
분석 결과 검토 비용을 줄이려면 개발자 워크플로에 자연스럽게 녹이는 데도 신경써야 함

## 20.2 정적 분석을 적용하며 깨우친 핵심 교훈

### 1. 개발자 행복에 집중하자.

- **거짓 음성** : 분석 도구가 검출하도록 설계된 문제를 놓치는 것
- **거짓 양성** : 문제가 없는데 문제를 찾았다고 보고하는 경우
  - 정적 분석 도구를 사용하고 싶게 하려면 이 비율을 낮추는 게 중요
  - 정적 분석 도구가 문제를 찾았음에도 진단 메시지의 설명이 불충분하거나, 사소한 문제일 때 사람들은 거짓 양성으로 오해한다.
  - 검출한 문제에 대해 개발자가 긍정적인 조치를 취하지 않는 경우가 **유효 거짓 양성**이다.
  
### 2. 정적 분석을 개발자 워크플로에 반드시 끼워 넣자.

구글은 정적 분석을 코드 리뷰 도구(Critique)에 통합하여 핵심 워크플로에 녹였다.  
개발자는 코드 리뷰를 기다리는 동안 정적 분석을 수행하고 경고를 해결하기 딱 좋다.

### 3. 사용자가 기여할 수 있도록 하자.

간단한 API를 제공하여 누구든 분석기를 만들 수 있게 열어주면 더 좋다.

## 20.3 Tricorder: 구글의 정적 분석 플랫폼

- Not useful 버튼 : 분석 결과가 유용하지 않은 경우 분석기 작성자에게 피드백하는 버튼
- Please fix 버튼 : 코드 리뷰어가 변경 작성자에게 분석 결과를 조치하도록 요청하는 버튼

구글은 정적 분석을 가능한 한 컴파일러에 통합해 더 앞단에서 문제를 알려주고, 빌드 자체를 실패시키려고 한다.
