# 챕터 11 테스트 개요

개발 주기에서 버그를 발견하는 시기가 늦어질수록 고치는 비용은 커진다

## 테스트 작성 이유

시스템에 특정 값을 입력하고, 출력 결과를 확인하여, 시스템이 기대한 대로 동작한 것인지를 판단하게 됨    

그리고 간단한 테스트가 수백 수천개 모이면(테스트 스위트) 제품이 전체적으로 의도한 설계대로 잘 동작 하는지, 혹은 언제 그러지 못한지를 이야기할 수 있게 됨

테스트는 엔지니어에게 신뢰를 줄 때만 가치가 있다~~

구글은 문제가 터진 후에야 테스트를 고민하는건 안된다고 결론 지었다고 한다~

### 작성하고, 수행하고, 조치하라

건실한 자동 테스트 문화에서는 모두가 테스트를 작성하고 공유하도록 장려한다~~ 그리고 테스트들을 정기적으로 실행한다~

가장 중요한건 테스트가 실패하면 바로 조치하도록 권장해야 테스트 프로세스를 신뢰하고 계속 이어갈 수 있다~~~

### 테스트 코드가 주는 혜택

- 디버깅 감소
- 자신있게 변경!(리팩토링은 기존 테스트를 수정할 필요가 없으니까 권장됨!)
- 더 나은 문서자료! (테스트가 명확하고 간결해야지만 문서자료로서의 역할을 훌륭히 수행할 수 있으니 명심)
- 더 단순한 리뷰 (리뷰어가 제대로 작동하는지 검증하는 시간 줄여주니까~) 
- 사려 깊은 설계 (코드와 강하게 결합되지 않고 특정 역할에 집중해야 함)
- 고품질의 릴리스를 빠르게 (솔직히 공감안감. 테스트 고수 있어야 가능한거 아님?)

## 테스트 스위트 설계하기

구글은 작은 테스트가 더 빠르고, 안정적이고, 평균적으로 고통이 적다는걸 알아차렸음 => 근데 작다는건 무슨 의미임? 단위테스트? 그럼 통합테스트에서 작다는?    
=> 모든 테스트 케이스에는 두가지 독립된 요소가 있음. 크기와 범위

- 크기는 테스트 케이스 하나를 실행하는 데 필요한 자원 e.g) 메모리, 프로세스, 시간
- 범위는 검증하려는 특정한 코드 경로

### 테스트 크기 

크기 가늠하는 기준은 코드 줄수가 아님

어떻게 동작하고 무엇을 하고 얼마나 많은 자원을 소비하는지로 평가함

e.g) 작은 테스트는 프로세스 하나에서 동작, 중간 크기 테스트는 기기 하나에서, 큰 테스트는 자원을 원하는 만큼 사용

구글은 '단위','통합 테스트' 대신 이 정의를 사용함 ㄷ ㄷ

#### 작은 테스트 

제약이 가장 엄격. 바로 테스트가 단 하나의 프로세스에서 실행되어야 함.

DB나 제 3의 프로그램 쓰면 안 됨

#### 중간 크기 테스트

여러 프로세스나 스레드 사용 가능

=> 외부 요인이 개입 되므로 성능과 결정성을 온전히 우리 스스로가 보장 불가능   
=> 유연성이 커지면서 테스트는 느려지고 비 결정적이 될 가능성이 높아짐

#### 큰 테스트 

e.g) 전체 시스템의 end-to-end 테스트

느려지거나 비결정성이 커질 가능성 훨씬 높아짐 

### 테스트 크기와 무과난 공통 특성

테스트가 깔끔하고 간경하면 테스트가 의도대로 동작하는지를 검증해야 하는 리뷰어의 어깨를 가볍개 해준다~


## 테스트 범위

- 좁은 범위 테스트: 독립된 클래스, 메서드 같은 일부 로직 검증
- 중간 범위 테스트(통합테스트): 컴포넌트들 사이의 상호작용 검증
- 넓은 범위 테스트(기능 테스트, end-to-end 테스트, 시스템 테스트): 클래스, 메서드들의 조합의 검증, 시스템 간 상호작용

단위테스트 범위가 좁다 => '실행'되는 코드가 아닌 '검증'되는 코드의 양이 기준임

구글은 단위테스트 80%, 통합테스트 15%, end-to-end 5% 되도록 한다고 함

통합 테스트 비율을 늘리면 테스트 스위트의 전체 수행 시간은 길어지지만 구성요소 사이의 문제를 더 많이 잡아낼 수 있고,   
단위 테스트 비율을 늘리면 테스트 스위트가 매우 빠르게 완료되고 일반적인 로직 버그를 많이 잡아낼 수 있음

그니까 시스템 아키텍처와 조직의 현실에 맞게끔 조화롭게 혼합되어 있으면 좋은 테스트 스위트라 할 수 있다~~~~

### 의도적으로 실패 상황을 만드는 테스트

언젠가는 실패가 찾아오니 재난이 일어날 때까지 기다리지말고 시스템이 재난에 잘 대응하는지 테스트 해보자.

신뢰할 수 있는 시스템이라면 부정적인 조건을 예측하고 대응 방식을 통제할 수 있어야 한다!!

## 구글 규모의 테스트

거대한 테스트 스위트를 잘 관리하는 비결은 테스트를 존중하는 문화이다!

테스트를 견고하게 만든 엔지니어에게 보상해라! 간단한 코드 변경에도 시간이 제법 소요된다면 테스트를 더 견고하게 작성하는데 노력을 기울여라~

문화를 가꾸는 일과 더불어 린터를 개발하거나 문서자료를 보강하는 등, 안좋은 테스트를 만드는 실수를 줄여주는 테스트 인프라에도 투자해야 된다!

테스트 관리 비용을 낮추는데에 투자해라!!

## 화장실에서도 테스트

Testing on the toilet 참신했음. 

농담에서 시작했지만 모든 테스트 관련 활동 중 가장 오래 시행되고 영향력도 가장 컸다고 함 ㄷ ㄷ

