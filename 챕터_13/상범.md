# 챕터 13 테스트 대역

앞선 챕터 11, 12 에서는 작은 테스트가 80%나 차지해야 하는 이유에 대해 설명했음

근데 제품은 때로는 여러 프로세스나 기기를 연동시켜야 하기 때문에 작은 테스트로는 검증하지 못하는 영역이 존재함

이럴 때 테스트 대역이 실제 구현보다 훨씬 가벼워서 빠르고 안정적인 작은 테스트로 대응할 수 있게 도와줌

테스트 대역: 테스트 더블, 실제 구현 대신 사용 할 수 있는 객체나 함수. 인메모리 데이터베이스가 대표적인 예시라고 함

## 테스트 대역이 소프트웨어 개발에 미치는 영향

- 테스트 용이성
  - 테스트 대역을 사용하려면 코드베이스가 테스트하기 쉽도록 설계되어야 함
- 적용 가능성
  - 테스트 대역을 제대로 활용하면 엔지니어링 속도가 크게 향상하는데, 잘못 사용하면 오히려 깨지기 쉽고 복잡하고 효율도 쓰레기 됨
    - 특히 커다란 코드베이스에서 잘못사용하면 단점이 배가되어 생산성 크게 떨어뜨린다고 함 ㄷ ㄷ
    - 실제로 테스트 대역을 활용하기에 적절하지 않은 경우가 많아서 되도록 실제 구현을 이용하길 권한다고 함 ㄷ ㄷ ㄷ
- 충실성
  - 테스트 대역이 실제 구현의 행위와 얼마나 유사한지 정도를 의미
  - 일반적으로 실제보다 훨씬 단순해야 되긴 함

## 테스트 대역 @구글

구글도 테스트 대역 도입해서 역효과 낸 예가 많다고 함. 이러한 경험이 쌓여서 올바르게 사용하는 관례를 발전시켰다고 함

요즘 많은 엔지니어가 모의 객체 프레임워크 피하고 실제에 더 가까운 테스트 작성한다고 하네요

## 테스트 대역 활용 기법

### 속이기(가짜 객체)

실제 구현과 비슷하게 동작하도록 가볍게 구현한 대역

이게 조심해야 하는게 미래의 행위까지도 비슷하게 흉내 내야 하기 때문에 결코 쉽게 생각할 문제가 아닐 수 있음

### 뭉개기(스텁)

원래는 없던 행위를 부여하는 과정 => 스텁

함수가 반환할 값을 지정한다고 하면 이를 반환값을 뭉갠다(스텁한다) 라고 말함

보통 모의객체 프레임워크 이용해서 수행함

### 상호작용 테스트하기

대상 함수를 실제로 호출하지 않고 그 함수가 '어떻게' 호출되는지 검증하는 기법

상호작용 테스트도 모의객체(mock)으로 불리기도 함

## 실제 구현!

구글은 실제 구현을 선호하는 테스트 방식(고전적 테스트)으로 작성해왔음

좋은 테스트는 구현이 어떻게 구성되었느냐가 아닌 검사할 API를 중심으로 작성되어야 한다!

실제 구현을 이용한 테스트는 실제 구현에 버그가 있다면 실패함 => 이게 맞지

## 1. 가짜 객체

### 가짜 객체가 중요한 이유

'가짜 객체'는 빠른 것은 물론 '실제 객체'를 사용할 때의 단점을 제거한 채 테스트를 효과적으로 수행할 수 있게 해줌

가짜 객체가 실제 구현과 다르게 동작한다면, 가짜 객체를 이용하는 테스트들은 쓸모 없어진다

가짜객체가 지연시간과 자원소비의 충실성 100%가 적용되지 않을텐데, 100% 충실하지 않아도 괜찮다

## 2. 뭉개기(스텁)

### 위험성

스텁은 적용하기 쉬워서 실제 구현을 이용하기 여의치 않을 때마다 엔지니어들을 유혹함.

과용하면 테스트 유지보수할 일이 늘어나서 오히려 생산성 저하됨

#### 불명확해진다

코드 읽는 이의 눈을 어지럽혀 테스트 의도 파악 어렵게 함

#### 깨지기 쉬움

시스템의 내부 구현 방식이 테스트에 드러나서 내부가 다르게 구현되면 테스트 코드도 같이 수정되어야 함

### 스텁이 적합한 경우

실제 구현이나 가짜 객체로는 원하는 반환값을 얻거나 특정 오류를 일으키기가 불가능할 수 있다

스텁으로는 함수의 동작을 테스트 코드에서 정의할 수 있으므로, 이럴 때 쉽게 원하는 결과를 얻을 수 있다

> 근데 또 책에서는 스텁을 활용하기 괜찮은 상황일지라도 되도록 실제 구현이나 가짜 객체를 이용하라고 권함. 걍 스텁 쓰지 마라

## 3. 상호작용 테스트 하기

상호작용 테스트: 대상 함수 구현을 '호출하지 않으면서' 그 함수가 어떻게 호출되는지 검증하는 기법

상태 테스트: 대상 시스템을 호출하여 올바른 값을 반환하는지, 상태가 올바르게 변경되었는지 검증하는 기법

이것도 상호작용 테스트 말고 상태 테스트 사용하라고 권함



만약 단위테스트에서 상태 테스트를 수행할 수 없다면, 상호작용 테스트를 추가하는 대신 더 큰 범위의 테스트 스위트에서 상태 테스트를 수행하여 보완해라







