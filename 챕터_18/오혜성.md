# 빌드 시스템과 빌드 철학

- Blaze
  - 구글의 빌드 시스템
  - 퇴사한 구글 직원들이 몇 차례나 다시 구현햇고 2015년에 bazel이라는 이름의 오픈소스로 세상에 공개

## 기반

### 태스크 기반
  - 태스크 기반 프레임워크에서는 성능, 정확성, 유지보수성 문제를 한 번에 해결할 수 없음
  - 빌드 중에 실행되는 스크립트를 엔지니어가 작성할 수 있다는 것은 빌드를 빠르고 정확하게 수행하는 데 필요한 정보 일부가 누락될 수 있기 때문

### 아티팩트 기반
  - 엔지니어가 빌드할 대상을 명시하면 도구가 나머지 단계를 실행, 스케줄링 함
  - 어떤 도구를 언제 실행할지를 빌드 시스템이 완전히 통제하므로 정확성을 보장하면서도 효율적으로 실행 가능

- 함수형 프로그램이 하는 일과 빌드 시스템이 하는 일은 같음
  - 같은 입력에 같은 출력을

## 외부 의존성

- 빌드가 결정적일 수 있게 하기 위해 외부 의존성 각각의 암호화 해시를 워크스페이스 차원의 파일에 기록해 문제를 해결함

> JS 진영 패키지 매니저들의 .lockfile과 동일한 목적과 매커니즘

## 시간, 규모, 트레이드오프

- 빌드 시스템의 역할은 세월이 흐르고 규모가 커져도 코드를 쉽게 다룰 수 있게 해주는 것

## 마치며

- 때로는 엔지니어의 힘과 유연성을 제한해야 생산성을 높일 수 있다
  - 빌드 시스템이 대부분의 일을 알아서 해결해주는 덕분에 엔지니어들은 빌드 로직과 씨름하는 대신 자신의 애플리케이션을 작성하는 가장 재미난 일에 집중할 수 있기 때문에 구글 엔지니어들은 별 불만이 없음

> 일부 공감되기는 하는데, 뭔가 무지에서오는 갈증도 있긴 할듯 (내가 그럼)

## 핵심 정리

- 외부 의존성 버전을 명확하게 관리해라. 단순히 최신 버전에만 의존하면 늪에 빠진다

> 이전 회사에서 라이브 배포 이후에 갑자기 서버 메모리가 무한으로 늘어나서 서버가 내려가는 ... 일이 있었는데
> 관련한 동작을 하나도 수정 안한 배포라 늪에 빠졌으나
> sentry 버전이 latest로 돼 있었고, 그날 메이저 버전의 첫 버전이 배포된 날이라 그랬음 ㅋㅋㅋ

> 뭐 눈에는 뭐만 보인다고, 읽으면서 JS 진영의 빌드 시스템(모노레포)들이 생각났음
> 터보레포랑 Nx 모두 태스크 기반이지만 아티팩트 기반도 끼얹은 형태라고 함 (캐싱과 병렬 실행)
>
> https://bejamas.com/compare/bazel-vs-turborepo
> 이런 사이트도 있네용