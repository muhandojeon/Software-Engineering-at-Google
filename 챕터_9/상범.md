# 챕터9 코드 리뷰

> 구글은 Critique 라는 코드리뷰 도구를 이용한다고 해서 코드래빗 같은건가 보다 생각했는데 19장 슬쩍 보니 더 큰 시스템 같아보여서 놀랐음;

## 코드리뷰 @구글

### 승인절차

1. 다른 엔지니어로부터 **정확성**과 **이해 용이성**을 평가 받음
2. 디렉토리별 소유자(게이트키퍼)에게 승인 받음 
- 소유자 역할은 테크 리드나 해당 영역의 기술 전문가임
- 이 코드는 유지보수 하기 쉬운가? 내게 기술 부채를 안겨주나? 우리 팀원 중에 이 코드를 유지보수해줄 전문가가 있나? 관점으로 살펴 보기
3. 누군가로부터 '가독성' 승인 받기

세가지 역할 모두를 한 사람이 처리할 수 있음에도 모든 코드 리뷰를 이런 사람들이 도맡아 수행하지 않는 이유는? **확장성** 떄문이다~

역할을 셋으로 나눔으로써 코드 리뷰 프로세스가 더 유연해진다! 

## 코드리뷰의 이점

구글은 아무리 작더라도 코드베이스를 수정하는 거의 모든 변경에 코드리뷰를 요구한다

이러한 강제적인 규제는 비용을 유발하고 엔지니어링 속도에도 영향을 준다

그럼에도 불구하고 구글이 리뷰 프로세스를 강제하는 이유는 뭘까? 대표적인 이점은 아래와 같다!

- 코드 정확성 확인
- 코드 이해 용이성
- 코드 일관성
- 팀의 소유권(주인의식)을 강하게 느낌 => 심리적, 문화적 이점
- 지식 공유
- 고드 리뷰 자체의 기록이 남는다!

### 코드 정확성

리뷰어는 일반적으로 해당 변경에 적합한 테스트가 갖춰졌는지, 설계는 적절한지, 정확하게 동작하고 효율적인지를 살핀다.

또한, 정확성 검사는 변경이 코드베이스에 버그를 심지 않도록 걸러주는 역할도 한다!

이때, 정확성 평가가 주관적으로 흘러가지 않도록 하기 위해 일반적으로 변경 작성자가 선택한 방식을 존중해준다! (설계, 기능 측면 모두)

> 주관적인게 많아서 근거와 설득력 기반으로 리뷰 해야 한다고 생각

요즘은 정적 분석이나 자동화 테스트 등을 활용해 코드 정확성 검사에서 사람의 역할을 확실하게 줄여준다~

### 코드 이해 용이성

리뷰어는 작성자가 선택한 설계를 존중하되 그와 별개로, 코드가 잘 이해되지 않으면 '고객은 항상 옳다'라는 관점에서 질문을 던져보는게 좋다!

작성자는 비판이 있다고해서 로직을 바꿔야되는건 아니고, 설명을 더 명확하게 해야 할 필요는 있을 것이다!

> 코드에는 이유가 있어야 되고 그걸 다른 사람에게 잘 설명할 수 있어야 된디~ 다른 사람 코드가 더 좋다고 느꼈으면 수정해도 되지만 무조건 수용적이지는 말자~

### 코드 일관성

규모가 커지면 내가 작성한 코드를 결국 다른 사람이 이용하게 되고 유지보수 하게 된다   

따라서 코드는 일정한 표준을 따라야 하고 그래야 조직 안에서 이해되고 유지보수 될 수 있다

너무 복잡해서는 안되고, 코드가 단순해야 다른 이들이 이해하기 쉽고 유지보수 하기 쉽다!

### 심리적, 문화적 이점

- 코드 리뷰를 통해 코드는 '자신의 것'이 아니라 협업을 통해 만들어지는 '조직의 공동 소유물'임을 인식시켜주는 효과가 있음
- 코드 리뷰는 다른 사람의 피드백을 받아들이고, 더 큰 이익을 위해 적절히 타협하도록 이끌어주는 역할이다
  - 자신의 코드에 대해 비판적 피드백이 달갑지 않은 것은 심리적으로 당연하다.
  - 코드 리뷰 프로세스는 리뷰어들에게 비판적으로 검토해달라고 만든 제도이다 (그래서 구글 코드 리뷰 도구이 이름이 critique(비평) 이다)
  - 따라서 리뷰어들이 주어진 역할대로 비판한다고 해서 비난하면 안되는 것이다!
- 코드리뷰의 또다른 심리적 이점은 검증이다!
  - 뛰어난 엔지니어조차 가면 증후군을 겪거나 자기비판이 너무 심할 수 있는데, 코드리뷰는 그들의 작업 결과를 검증하고 인정해주는 효과가 있다.
  - 리뷰 과정에서 종종 아이디어를 교환하고 지식을 공유하게 되어 리뷰어와 작성자 모두에게 이롭다!

> 근데 이 모든게 유용하려면 리뷰어의 역할도 중요함 ㅎㅎ 

### 지식 공유

피드백을 주고받는 과정에서 그 변경이 특정 방식을 선택한 이유를 물어볼 수 있다. => 정보 교환, 지식 공유 촉진

리뷰를 통한 지식 공유는 지역, 국가, 프로젝트 경계에 구애받지 않고 코드베이스 구석구석의 모든 엔지니어에게 빠르게 전파된다~    
=> 곧바로 적용할 수 있는 지식을 적시에 전달해주기 때문에 코드 리뷰야말로 지식을 퍼뜨리기에 완벽한 기회다!

## 코드 리뷰 모범 사례


### 공손하고 전문가답게

1. 리뷰어는 작성자의 방식에 대해 성급히 결론짓지 않게 주의해야 한다.

**그 방식이 잘못되었다고 가정하기 전에 그렇게 처리하게 된 이유가 무엇인지부터 물어보는게 좋다!**

> 예전에 이런적이 몇번 있었음. 그렇게 처리하게 된 이유부터 먼저 물어보자!

2. 리뷰어는 신속하게 피드백 해야 한다!

24시간 이내에 최대한 피드백 해주고 그 안에 못해줄 거 같으면 언제까지 리뷰하겠다는 코멘트 남기기

리뷰를 요청했는데 이것 조금 저것 조금 식으로 피드백하는 것만큼 작성자를 짜증나게 하는 일도 없다

> 공감됨 ㅋㅋ

리뷰어에게 전문가다움을 기대하는 만큼 작성자에게도 전문가다움이 요구된다

'나'와 '나의 코드'를 동일시하지 말고, 내가 제안한 변경은 혼자의 것이 아닌 팀의 소유임을 잊지 마라!

코드가 코드베이스에 반영되는 순간부터 더 이상 내 것이 아니니, 제기된 질문들에 흥분하지 말고 왜 그렇게 처리했는지 설명할 준비를 미리 해두자

> 전문가 답게 행동하자!

코드리뷰 과정에서 리뷰어가 단 댓글은 모두 할일로 취급해야 한다. 모두 수용할 필요는 없지만, 적어도 고민은 해봐야 한다!

> 이와 관련해서 시행중인 코드리뷰 코멘트 룰이 있음. [다들 알고 계시는 뱅xxxx의 코드리뷰 Pn 룰](https://blog.banksalad.com/tech/banksalad-code-review-culture/)

코드리뷰 시에 중요한건 작성자와 리뷰어 모두에게 배움의 기회라는 점을 기억해야한다!! 그래야 어떤 의견 충돌도 감정싸움으로 번지지 않을 것이다!

같은 이유로, 내가 짠 코드를 누군가가 변경하려고 해도 제안자의 견해에 수용적인 자세로 응해야 한다. 제안된 변경이 코드베이스를 개선해주는 한 우리는 감사를 표해야 한다.

> 수용적인 자세까진 필요하지 않다고 봄.. 구조를 많이 변경한다고 하면 그렇게 변경하려는 이유를 소유자에게 설명해주고 변경해야되지 않나 싶네요

### 작게 변경하기, 변경 설명 잘쓰기

변경사항을 리뷰하기 쉽게 올리고, 변경 설명도 자세하게 쓰자~
