# CHAPTER 23 지속적 통합

CI 시스템 구축에는 많은 비용이 든다.  
하지만 제품 개발 단계의 뒤에서 발생하는 큰 비용을 앞에서 저렴하게 처리하는 비용이라고 생각하면 감수할 만하다.

## 23.1 지속적 통합이란?

- 팀원들이 작업 결과를 자주 통합하는 소프트웨어 개발 방식
- 통합할 때마다 자동 빌드(테스트 포함)하여 통합 오류를 빠르게 찾아낸다.
- **빠르게 진화하는 복잡한 생태계 전체를 지속적으로 조립하고 테스트하는 개발 방식**

### 빠른 피드백 루프

버그는 발견하는 시점이 늦을수록 처리 비용이 기하급수적으로 증가한다.  
CI는 우리가 빠른 피드백 루프를 이용하도록 유도하여 버그 비용을 최소로 줄여준다.  

빠른 피드백 루프 예시 : 카나리 배포, 실험, 기능 플래그

### 자동화

여러 개발 활동 중 CI는 특히 빌드와 릴리스 프로세스를 자동화한다.  
각각을 따로 지속적 빌드와 지속적 배포라고 한다.

#### 지속적 빌드

지속적 빌드(CB)는 가장 최근의 코드 변경을 헤드(트렁크)에 통합한 다음, 자동으로 빌드와 테스트를 수행한다.  
CB에서는 테스트도 빌드의 한 과정으로 보기 때문에 컴파일을 통과하더라도 테스트에 실패하면 빌드 실패로 간주한다.

#### 지속적 배포

지속적 배포(CD)는 헤드로부터 지속해서 최신 코드와 설정 정보를 가져와서 릴리스 후보를 만들어낸다.  
릴리스 후보(RC) : 자동화된 프로세스가 만든 배포 가능한 단위

### 지속적 테스트

무슨 테스트를 언제 실행할지를 정하는 게 CI의 주된 목표  

### CI의 과제

- 프리서브밋 최적화(엔지니어의 생산성을 희생하지 않도록 어떤 테스트를 어떻게 수행해야 할지 고민)
- 범인 찾기와 실패 격리
- 테스트를 실행할 자원 제약

### 밀폐 테스트

밀폐 테스트 : 모든 것을 갖춘 테스트 환경에서 수행하는 테스트  

구글은 범위가 넓은 테스트에는 밀폐된 백엔드를 주로 이용한다.  
서비스 중인 백엔드와의 통신은 안정적이지 않을 수 있기 때문이다.  
밀폐 테스트에 필요한 백엔드는 가짜 서버로 대체할 수 있다.

밀폐 테스트는 더 큰 테스트의 불안정성을 줄여주고, 실패를 효과적으로 격리해 CI의 골칫거리들을 해소한다.  
하지만 밀폐형 백엔드 방식은 자원을 더 많이 쓰고 설정하는 시간도 필요하기 때문에 더 비싼 선택이 될 수도 있다.  
그래서 많은 팀이 밀폐형 백엔드와 실제 백엔드를 조합해 테스트한다.

## 23.2 지속적 통합 @ 구글

구글에는 지속적 빌드 시스템 TAP(Test Automation Platform)이 있다.  
이 시스템을 이용해 코드베이스 전체를 지속적으로 빌드한다.  
자동화 테스트 대부분을 여기에서 책임지고, 거의 모든 변경의 수문장 역할을 한다.  
엔지니어가 코드를 서브밋하면 TAP이 연관된 테스트를 실행한 후 성공 여부를 보고한다.  
테스트에 통과하면 변경을 코드베이스에 반영할 수 있게 된다.
