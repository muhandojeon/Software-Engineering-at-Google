# CHAPTER 14 더 큰 테스트

## 14.1 더 큰 테스트란?

더 큰 테스트의 특성
- **느리다**.
- 자원 및 트래픽을 공유하기 때문에 **밀폐되지 않을 수 있다**.
- 다른 테스트나 사용자 상태에 영향을 받을 수 있어서 **비결정적일 수 있다**.

만약 새로운 구글 지도 API가 나왔다면?  
단위 테스트보다는 직접 사이트에 들어가서 동작하지 않는 기능이 있는지 확인하는 게 좋음

| 단위 테스트 | 더 큰 테스트 |
| :-: | :-: |
| 개별 함수, 객체, 모듈에 대한 확신을 줌 | 시스템 전체가 의도대로 동작하는지 확신을 줌 |

### 더 큰 테스트가 존재하는 이유

#### 1. 충실성

실제 행위를 얼마나 충실하게 반영했느냐를 의미하는 충실성을 높이기 위해 더 큰 테스트가 존재  
프로덕션은 당연히 테스트 충실성이 가장 높은 환경  
충실성이 높아질수록 비용이 커져서 테스트 실패 시 입는 손해도 큼

#### 2. 단위 테스트가 손대기 어려운 영역 존재

- 부정확한 테스트 대역
- 설정 문제
- 과부하 시 나타나는 문제(성능, 부하, 스트레스 테스트)
- 예기치 못한 동작, 입력, 부작용
- 창발적 행위와 진공 효과

### 더 큰 테스트를 만들지 않는 이유

- 소유권 문제
- 표준화 부족

## 14.2 더 큰 테스트 @ 구글

더 큰 테스트는 수명이 긴 소프트웨어에 유용하지만, 소프트웨어 수명이 길어질수록 주 관심사가 테스트 유지보수로 옮겨간다.  
건강한 상태를 오래 유지하는 핵심은 개발 시작 후 며칠 안으로 단위 테스트를 만들어 테스트 피라미드를 쌓는 것이다.  
더 큰 테스트는 원하는 규모에서 잘 작동하면서도 충실성이 높게 구현하는 게 관건이다.  
통합 테스트라고 하더라도 가능한 한 작을수록 좋다. (초거대 테스트 하나 < 거대한 테스트 여러 개)

## 14.3 큰 테스트의 구조

**대규모 테스트의 핵심은 테스트 대상 시스템(System Under Test, SUT)**  
SUT의 범위 = 대규모 테스트의 범위  
구글에는 다양한 형태의 SUT가 존재하며, 밀폐성과 충실성에 의해 SUT의 형태가 결정된다.  

프론트엔드와 백엔드가 만나는 경계를 포괄하는 테스트는 되도록 피해야 한다.  
서드파티 의존성은 테스트를 분할하는 중요한 경계가 되어준다.

구글 외부에서는 고객 주도 계약 테스트용 프레임워크를 활용하는 사례가 늘고 있다.  
고객과 서비스 제공자 모두가 지켜야 할 계약(명세)을 정의하고, 이 계약을 토대로 자동화된 테스트를 만들어내는 방식이다.  
구글은 프로토콜 버퍼를 사용하고, 구글 외부에서는 Pact Contract Testing, Spring Cloud Contracts 등을 사용한다.

대규모 테스트는 두 가지 데이터가 필요하다.
- 시드 데이터 : SUT를 사전 초기화하는 데이터
- 테스트 트래픽 : 테스트 수행 과정에서 SUT로 보내는 데이터

## 14.4 더 큰 테스트 유형

구글에서 사용하는 큰 테스트의 종류
- 하나 이상의 바이너리에 대한 기능 테스트
- 브라우저와 기기 테스트
- 성능, 부하, 스트레스 테스트
- 배포 설정 테스트
- 탐색적 테스팅
- A/B 차이(회귀) 테스트
- 사용자 인수 테스트(User Acceptance Testing, UAT)
- 프로버와 카나리 분석
- 재해 복구와 카오스 엔지니어링
- 사용자 평가(dogfooding, 실험, 평가자 감정)

> 저는 UAT, dogfooding을 경험해 봤습니다.  
> UAT는 프로덕션 데이터를 기반으로 QA가 필요한 경우에만 별도의 환경을 세팅해 테스트를 진행하고 있어요.  
> dogfooding은 제품 이해도가 낮다고 판단되는 영역에 한해 직접 기능을 사용해 보며 개선점을 찾는 방식으로 진행해요.  
> 예를 들어 공고 지원자 관리 플로우에 대한 이해를 높이고 개선 방안을 논의하기 위해 dogfooding을 진행한 적이 있습니다.  
> 이때 PM분께서 진행 순서를 문서로 정리해 주시고, QA분께서 지원자가 있는 계정을 준비해 주셨어요.  
> 이후에는 모든 크루원들이 준비된 계정으로 접속해 순서에 따라 기능을 사용해 보고, 피드백과 느낀 점을 공유했어요.  
> 유저 입장에서 제품을 바라볼 수 있었던 의미 있는 시간이었습니다👍

> 듀오링고의 dogfooding 사례도 공유해 봅니다([아티클](https://blog.duolingo.com/dogfooding-app))  
> 듀오링고는 CEO를 포함해서 70% 이상의 직원들이 dogfooding에 참여한다고 해요.  
> 직원들이 테스트를 시작하면 ANR, 앱 크래시, OOM, frame rate 등 다양한 지표들이 수집되고  
> 내부에서 개발한 Release Dashboard를 통해 성능을 체크할 수 있다고 합니다.  
> 버그 신고 과정을 간소화하기 위해서 Shake-to-Report라는 내부 툴을 만들었고,  
> 기기를 흔들기만 해도 버그 신고 창이 뜨도록 구성되어 있다고 합니다.  
> 버그 리포트에는 스크린샷과 함께 설정, 앱 버전, 학습 중이던 코스 등 다양한 메타데이터가 자동으로 첨부된다고 해요.

구글은 소프트웨어 설계의 일환으로 테스트 계획의 초안도 작성한다.  
테스트 계획의 핵심은 '어떤 테스트가 필요하고, 각각의 테스트를 얼마나 많이 수행해야 하는지'에 대한 개략적인 전략 확립이다.  
구글에서는 테스트 엔지니어가 제품에 적합한 테스트 전략의 윤곽을 그린다.

## 14.5 큰 테스트와 개발자 워크플로

큰 테스트를 엔지니어에게 친숙한 방식으로 수행하려고 노력해야 한다.  
- 테스트 속도 개선하기
- 불규칙한 결과에서 벗어나기
- 이해되는 테스트 만들기
- 소유권 정보를 잘 기록해서 테스트 소유자를 중심으로 자동화 시스템 구축하기
